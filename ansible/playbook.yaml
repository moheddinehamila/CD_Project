---
- hosts: EC2_Instance
  become: true
  become: yes
  gather_facts: no
#  vars_files:
#   - vars/default.yml

  tasks:
   - name: Update apt-get repo and cache
     apt: update_cache=yes force_apt_get=yes cache_valid_time=3600

   - name: Install prerequisites for Docker repository
     apt:
       name: ['apt-transport-https', 'ca-certificates', 'curl', 'gnupg2', 'software-properties-common']
       update_cache: yes

   - name: Add Docker GPG key
     apt_key: url=https://download.docker.com/linux/ubuntu/gpg

   - name: Add Docker APT repository
     apt_repository:
       repo: deb [arch=amd64] https://download.docker.com/linux/{{ansible_distribution|lower}} {{ansible_distribution_release}} stable

   - name: Install Docker CE
     apt:
       name: ['docker-ce', 'docker-ce-cli', 'containerd.io']
       update_cache: yes


   - name: Pull default Docker image
     docker_image:
      name: "{{ image_name }}"
      source: pull

   - name: run container
     docker_container:
       image: "{{ image_name }}"
       ports: 80:8080
       state: started
